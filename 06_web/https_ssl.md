# HTTPS

- HTTPμ μ•”νΈν™”λ protocol λ²„μ „
- ν΄λΌμ΄μ–ΈνΈ, μ„λ²„ κ°„μ— λ¨λ“  ν†µμ‹ μ„ μ•”νΈν™”ν•κΈ° μ„ν•΄ SSLμ΄λ‚ TLSλ¥Ό μ‚¬μ©
- SSL (Secure Sockets Layer)
  - κ³Όκ±° λ³΄μ• ν‘μ¤€ κΈ°μ 
- [TLS](https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EA%B3%84%EC%B8%B5_%EB%B3%B4%EC%95%88) (Transport Layer Security)

## π“ HTTPS λ‚΄μ©
```text
HTTP -- *SSL/TLS* -- TCP -- IP -- Network Interface
```
- HTTPλ¥Ό TCP κ³„μΈµμ— λ³΄λ‚΄κΈ°μ „μ— λ³΄μ•κ³„μΈµμ„ κ±°μΉκ² λ¨
- λ³΄μ•κ³„μΈµμ€ SSL(Secure Sockets Layer)κ³Ό ν„λ€ λ€μ²΄ν’μΈ TLS(Transport Layer Security)λ΅ κµ¬ν„  
  (ν†µμƒμ μΌλ΅ SSL, TLS ν•©μ³ SSLμ΄λΌ λ¶€λ¦„)
- URLμ€ `https`λΌλ” μ¤ν‚΄μ„ ν†µν•΄ HTTPSλ¥Ό μ‚¬μ©ν•λ‹¤.
  - μ΄ λ• ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ `443`(κΈ°λ³Έκ°’) ν¬νΈλ΅ μ—°κ²°
  - handshakeκ°€ μ΄λ£¨μ–΄μ§€κ³  μ•”νΈν™”λ HTTP λ…λ Ήμ΄ λ’¤λ”°λ¦„


## SSL, TLS

### SSL
- μ›Ήμ—μ„ μ „μ†΅λλ” λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•λ‹¤.  
  μ¤‘κ°„μ—μ„ λ°μ΄ν„°λ¥Ό κ°€λ΅μ±„λ„ ν•΄λ…ν•  μ μ—†λ” λ³µμ΅ν• λ¬Έμλ§ λ³΄μ΄κ² λ¨
- λ°μ΄ν„° λ¬΄κ²°μ„±μ„ μ κ³µ, λ°μ΄ν„°μ— λ””μ§€ν„Έ μ„λ…μ„ ν•μ—¬ μλ„λ μμ‹ μμ—κ² λ„μ°©ν•κΈ° μ „μ— μ„λ³€μ΅°λμ§€ μ•μ•μμ„ ν™•μΈ
- SSL 2.0μ—μ„ μ·¨μ•½μ μ΄ λ°κ²¬λμ—κ³  3.0μ—μ„ κ°μ„ 
  - 2.0μ€ MITM(man-in-the-middle) μ ν•μ κ³µκ²©μ— μ·¨μ•½ν•λ‹¤λ” μ μ΄ λ“λ¬λ‚¨. 
  - μ΄λ΅ μΈν•΄ SSL ν•Έλ“μ‰μ΄ν¬ κ³Όμ • μ¤‘ μ  3μμ—κ² λ…Έμ¶μ΄ λμ–΄ κ¶ν•μ΄ μ—†λ” μ‚¬λμ΄ SSL μ„Έμ…ν‚¤λ¥Ό ν•΄λ…ν•  κ°€λ¥μ„±μ΄ μƒκ²Όμ
  - 3.0μ€ μ΄λ° MITM μ ν•μ κ³µκ²©μ„ κ°μ†μ‹ν‚΄.
  - 3.0μ—μ„ SHA-1 ν•΄μ‹± μ•κ³ λ¦¬μ¦μ„ Cipher Suiteμ—μ„ μ κ³µ
### TLS
- SSL 3.0 -> TLS 1.0 (SSLμ μƒλ΅μ΄ λ²„μ „)
- ν†µμƒμ μΌλ΅ SSLμ΄λΌκ³  λ¶€λ¥Έλ‹¤.
- HMAC(Key-Hashing for Message Authentication Code) λ°©μ‹μ„ μ‚¬μ©ν•¨μΌλ΅μ¨ κ°λ°© λ„¤νΈμ›ν¬μ—μ„ λ μ½”λ“λ¥Ό λ³€κ²½ν•  μ μ—†λ„λ΅ ν•¨  
  - SSL 3.0μ—μ„μ λ©”μ‹μ§€ μΈμ¦μ½”λ“(MAC) κΈ°λ¥λ³΄λ‹¤ μ•μ „

## π“ SSLμ— μ‚¬μ©λλ” μ•”νΈλ²•

- λ€μΉ­ν‚¤ μ•”νΈλ²•
  - μΈμ½”λ”©κ³Ό λ””μ½”λ”©μ— κ°™μ€ ν‚¤λ¥Ό μ‚¬μ©
  - κ°™μ€ ν‚¤λ¥Ό μ‚¬μ©ν•κΈ°μ— μ λ€λ΅ λ„μ„¤λλ©΄ μ•λ¨
  - λ°μ†΅μ, μμ‹ μκ°€ μ„λ΅ λ€ν™”ν•κΈ° μ„ν•΄μ„ κ°™μ€ κ³µμ ν‚¤λ¥Ό κ°€μ Έμ•Όν•¨
  - A, B, C -> Zμ™€ ν†µμ‹ ν•λ ¤λ©΄ AZ, BZ, CZ κ°„μ μ—°κ²°μ„ μ„ν• κ³µμ ν‚¤λ¥Ό κ°κ° μƒμ„±ν•΄μ•Ό ν•¨(λΉ„ν¨μ¨μ )
- κ³µκ°ν‚¤ μ•”νΈλ²•(λΉ„λ€μΉ­ν‚¤)
  - μΈμ½”λ”© ν‚¤λ” λ¨λ‘λ¥Ό μ„ν•΄ κ³µκ°(κ³µκ°ν‚¤), λ””μ½”λ”© ν‚¤λ” νΈμ¤νΈλ§μ΄ κ°€μ§€κ³  μμ
  - A, B, C -> Zλ΅ λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό λ• Zμ κ³µκ°ν‚¤ ν•λ‚λ§μΌλ΅ κ°€λ¥
  - κ³µκ°ν‚¤ λ°©μ‹μ μ•κ³ λ¦¬μ¦μ€ κ³„μ‚°μ΄ λλ ¤ μ„±λ¥μƒ μ΄μκ°€ λ°μƒν•  μ μμ  
    (**μ‹¤μ λ΅ κ³µκ°ν‚¤, λ€μΉ­ν‚¤ λ°©μ‹ νΌν•©ν•΄μ„ μ‚¬μ©**)

## π“ SSL Hanshake

TCP handshakeκ³Όμ •μ„ λ¨Όμ € κ±°μΉ ν›„μ— SSL handshakeκ°€ μ§„ν–‰

- κ³µκ°ν‚¤ λ°©μ‹μ€ μ»΄ν“¨ν… νμ›κ°€ λ§μ΄ ν•„μ”ν•κΈ°μ— μ„±λ¥μƒμ μ΄μκ°€ λ°μƒν•  μ μμ
- λ€μΉ­ν‚¤λ” ν•λ‚μ ν‚¤λ΅ μΈμ¦ μ‘μ—…μ„ μ§„ν–‰ν•κΈ°μ— μ»΄ν“¨ν… νμ›κ°€ κ³µκ°ν‚¤ λ°©μ‹λ³΄λ‹¤ λ ν•„μ”
- μ΄λ ‡κΈ°μ— SSL handshakeμ—μ„λ” λ€μΉ­ν‚¤ λ°©μ‹, κ³µκ°ν‚¤ λ°©μ‹μ„ νΌν•©ν•΄μ„ μ‚¬μ©ν•λ” λ°©μ‹μ„ μ„ νƒ

### π” handshake κ³Όμ •

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ•”νΈ ν›„λ³΄λ“¤μ„ λ³΄λ‚΄κ³  μΈμ¦μ„λ¥Ό μ”κµ¬
2. μ„λ²„λ” μ„ νƒλ μ•”νΈμ™€ μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λƒ„
3. ν΄λΌμ΄μ–ΈνΈκ°€ λΉ„λ°€μ •λ³΄λ¥Ό λ³΄λƒ„, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” ν‚¤λ¥Ό λ§λ“¬(λ€μΉ­ν‚¤)
4. ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” μ„λ΅ μ•”νΈν™”λ¥Ό μ‹μ‘ν•λ‹¤κ³  μ•λ¦Ό

#### 1. Client Hello

> ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ μ „μ†΅ν•λ” λ‚΄μ©

- ν΄λΌμ΄μ–ΈνΈμ—μ„ μƒμ„±ν• λλ¤ λ°μ΄ν„°
- ν΄λΌμ΄μ–ΈνΈκ°€ μ§€μ›ν•λ” μ•”νΈν™” λ°©μ‹ λ¦¬μ¤νΈ
  - ν΄λΌμ΄μ–ΈνΈκ°€ μ†ν™”ν•  μ μλ” μ•”νΈν™” κΈ°λ²•μ΄ λ¬΄μ—‡μΈμ§€λ¥Ό μ„λ²„μ— μ•λ ¤μ£ΌκΈ° μ„ν•΄ λ¦¬μ¤νΈμ—…μ„ λ³΄λ‚΄κ² λλ‹¤. (`Cipher Suite` λ©λ΅)
  - μ„λ²„λ§λ‹¤ μ†ν™”κ°€λ¥ν• μ•”νΈν™” κΈ°λ²•μ΄ λ‹¤ λ‹¤λ¥΄κΈ° λ•λ¬Έμ— μ΄λ¥Ό μ΅°μ¨ν•λ” κ³Όμ •μ΄ ν•„μ”  
    (ν΄λΌμ΄μ–ΈνΈ - μ„λ²„ κ°„ ν‘μƒ ν•„μ”)
- μ„Έμ… μ•„μ΄λ”” (μ¤‘μ”ν•μ§„ μ•μ)
  - μ΄λ―Έ SSL handshakeλ¥Ό ν• μƒν™©μ΄λΌλ©΄, κΈ°μ΅΄μ μ„Έμ…μ„ μ¬ν™μ©ν•κΈ° μ„ν•΄ μ‚¬μ©ν•  μ—°κ²°μ— λ€ν• μ‹λ³„μ

#### 2. Server Hello

> ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ°›μ€ λ°μ΄ν„°λ“¤μ„ κΈ°λ°μΌλ΅ μ„λ²„κ°€ λ‹¤μ‹ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅ν•λ” λ‚΄μ©

- μ„λ²„ μΈ΅μ—μ„ μƒμ„±ν• λλ¤ λ°μ΄ν„°
- μ„λ²„κ°€ μ„ νƒν• ν΄λΌμ΄μ–ΈνΈ μ•”νΈν™” λ°©μ‹
  - ν΄λΌμ΄μ–ΈνΈμ—μ„ λ³΄λ‚΄μ¤€ `Cipher Suite` λ©λ΅μ„ κΈ°λ°μΌλ΅ κ°€μ¥ μ•μ „ν•λ©΄μ„λ„ μ„λ²„μΈ΅μ—μ„ μ†ν™” κ°€λ¥ν• μ•”νΈν™” κΈ°λ²•μ„ μ„ νƒ
  - ν΄λΌμ΄μ–ΈνΈμ™€ ν‘μƒ κ³Όμ •

#### 3. Certificate
> μ„λ²„λ” μ„λ²„ μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ν•΄μ£Όκ³  ν•΄λ‹Ή μΈμ¦μ„κ°€ κ³µμΈλ CAλ΅λ¶€ν„° λ°κΈ‰λ μΈμ¦μ„μΈμ§€ ν™•μΈν•λ” μ‘μ—…μ΄ μ΄λ£¨μ–΄μ§„λ‹¤.

- **μΈμ¦μ„**
  - **κ°€μ¥ μ¤‘μ”, CA(Certificate Authority) κ°μΈν‚¤λ΅ μ•”νΈν™”λ μƒνƒ**
  - μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ λ³΄λ‚Έλ‹¤.
  - μΈμ¦μ„ μ•μ—λ” μ„λ²„μ κ³µκ°ν‚¤λ¥Ό ν¬ν•¨ν•κ³  μμ
- μ„λ²„λ΅λ¶€ν„° μ „μ†΅λ°›μ€ CA μΈμ¦μ„μ— λ€ν• ν™•μΈ
  - CA κ³µκ°ν‚¤λ¥Ό κ°€μ§€κ³  μ„λ²„κ°€ λ³΄λ‚΄μ¤€ μΈμ¦μ„μ— λ€ν• λ³µνΈν™” μ‹λ„  
    (λΈλΌμ°μ €λ” μ‹ λΆ°ν• λ§ν• μ„λ…κΈ°κ΄€μ— λ€ν• κ³µκ°ν‚¤λ¥Ό μ΄λ―Έ κ°€μ§€κ³  μμ)
  - λ³µνΈν™λ μΈμ¦μ„ λ‚΄μ©μ„ κΈ°λ°μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ— λ‚΄μ¥λ CA λ¦¬μ¤νΈλ“¤μ„ ν™•μΈ  
    (λΈλΌμ°μ €λ“¤μ€ μ—¬λ¬ μ„λ… κΈ°κ΄€μ μΈμ¦μ„κ°€ λ―Έλ¦¬ μ„¤μΉλ μ±„λ΅ μ¶ν•)
  - μΈμ¦μ„κ°€ μ—†λ‹¤λ©΄ μ‚¬μ©μμ—κ² κ²½κ³  λ§¤μ„Έμ§€ μ¶λ ¥
- `pre master secret` μƒμ„±
  - ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• λλ¤λ°μ΄ν„° + μ„λ²„κ°€ λ³΄λ‚΄μ¤€ λλ”λ°μ΄ν„°λ¥Ό μ΅°ν•©ν• ν‚¤
  - μ„Έμ… λ‹¨κ³„μ—μ„ λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›μ„ λ• μ‚¬μ©
  - μ—¬κΈ°μ„ **λ€μΉ­ν‚¤ μ•”νΈλ²•**μ„ μ‚¬μ©ν•λ”λ° λ€μΉ­ν‚¤μ΄κΈ° λ•λ¬Έμ— μ λ€λ΅ 3μμ—κ² μ μ¶λλ©΄ μ•λλ” μ •λ³΄


#### 4. (Server Key Exchange), Server Hello Done
- λ§μ•½ μΈμ¦μ„ λ‚΄λ¶€μ— μ„λ²„ κ³µκ°ν‚¤κ°€ μ—†λ‹¤λ©΄ μ„λ²„κ°€ μ§μ ‘ μ „λ‹¬ν•΄μ£Όλ” λ‹¨κ³„κ°€ `Server Key Exchange`  
- κ³µκ°ν‚¤κ°€ λ‹΄κ²¨μ Έ μμΌλ©΄ ν•΄λ‹Ή λ‹¨κ³„λ” μƒλµ
- μ΄ν›„ Serverμ ν–‰λ™μ΄ μ™„λ£λμ—μμ„ μ•λ¦¬λ” `Server Hello Done`

#### 5. Client Key Exchange
- `pre master secret`μ„ μ„λ²„μ κ³µκ°ν‚¤λ΅ μ•”νΈν™”
- μ•”νΈν™”λ `pre master secret`μ„ μ„λ²„μ— μ „μ†΅

#### 6. Changed Cipher Spec, Finished
- μ„λ΅ ν†µμ‹ ν•  μ¤€λΉ„κ°€ μ™„λ£λμ—μμ„ μ•λ¦¬λ” ν¨ν‚·μ„ ν΄λΌμ΄μ–ΈνΈ, μ„λ²„κ°„ κµν™

### π” μ„Έμ… ν‚¤ κ³µμ 

- μ„μ κ³Όμ •μ„ κ±°μ³μ„ ν΄λΌμ΄μ–ΈνΈ, μ„λ²„λ” μ–‘μΈ΅μ— λ™μΌν• λ€μΉ­ν‚¤λ¥Ό κ°€μ§€κ² λ¨
- `pre master secret` -> `master secret` -> **`session key`** μƒμ„±
- **session key** κ°’μ„ ν†µν•΄ λ€μΉ­ν‚¤ λ°©μ‹μΌλ΅ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν• ν›„ ν΄λΌμ΄μ–ΈνΈ, μ„λ²„κ°„ ν†µμ‹ μ΄ μ΄λ£¨μ–΄μ§

### π” μ„Έμ… μΆ…λ£
- λ°μ΄ν„° μ „μ†΅μ΄ μ™„λ£λλ©΄ SSL ν†µμ‹ μ΄ λλ‚¬μμ„ μ„λ΅ μ•λ¦¬κ² λ¨
- μ‚¬μ©ν–λ μ„Έμ… ν‚¤(λ€μΉ­ν‚¤)λ¥Ό νκΈ°

### π” SSL handshake μ •λ¦¬
- TCP handshake μ΄ν›„ μ΄λ£¨μ–΄μ§€λ” κ³Όμ •
- κ²°κµ­ ν΄λΌμ΄μ–ΈνΈ, μ„λ²„κ°„ λ³΄μ• μ•μ •μ μΈ λ€μΉ­ν‚¤ λ°©μ‹μ λ°μ΄ν„° κµν™μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ λ€μΉ­ν‚¤λ¥Ό μ„λ΅ κµν™ν•λ” κ³Όμ •
- λ€μΉ­ν‚¤λ¥Ό κµν™ν•λ” κ²ƒμ€ ν†µμ‹  κ³Όμ • μ¤‘κ°„μ— κ°€λ΅μ± λ¦¬μ¤ν¬κ°€ μκΈ° λ•λ¬Έμ— μ²μμ— κµν™ν•λ” κ³Όμ •μ—μ„ κ³µκ°ν‚¤ λ°©μ‹μ„ μ‚¬μ©
- μ²μ μ—°κ²° λ• κ³µκ°ν‚¤ λ°©μ‹μ„ μ‚¬μ©ν•κ³  μ—°κ²°λ μ΄ν›„μ— λ°μ΄ν„° κµν™μ—λ” λ€μΉ­ν‚¤ λ°©μ‹μ„ μ‚¬μ©ν•κ² λ¨μΌλ΅μ¨ ν¨μ¨μ μΈ ν†µμ‹ μ΄ μ΄λ£¨μ–΄μ§

## π“ References

- [HTTPS ν†µμ‹ κ³Όμ • μ‰½κ² μ΄ν•΄ν•κΈ°(SSL Handshake)](https://aws-hyoh.tistory.com/entry/HTTPS-%ED%86%B5%EC%8B%A0%EA%B3%BC%EC%A0%95-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-3SSL-Handshake)